#include <stdlib.h>#include <sys/types.h>#include <sys/time.h>#include "threadx.h"int eventx_init(event_t* event){    pthread_mutex_init(&event->mutex, NULL);    pthread_cond_init(&event->cond, NULL);    event->flag = 0;    return 0;}int eventx_unit(event_t* event){    pthread_cond_destroy(&event->cond);    pthread_mutex_destroy(&event->mutex);    event->flag = 0;    return 0;}int eventx_post(event_t* event){    pthread_mutex_lock(&event->mutex);    pthread_cond_signal(&event->cond);    event->flag = 1;    pthread_mutex_unlock(&event->mutex);    return 0;}int eventx_wait(event_t* event, unsigned int dwMilliseconds){    pthread_mutex_lock(&event->mutex);    if(event->flag == 1)    {        event->flag = 0;        pthread_mutex_unlock(&event->mutex);        return 0;    }    pthread_mutex_unlock(&event->mutex);    int ret = -1;    if(dwMilliseconds == 0)    {        pthread_mutex_lock(&event->mutex);        ret = pthread_cond_wait(&event->cond, &event->mutex);        pthread_mutex_unlock(&event->mutex);    }    else    {        struct timeval  now;        struct timespec dst;        gettimeofday(&now, NULL);        int tmp = now.tv_usec + dwMilliseconds * 1000; //tmp是us级别的        dst.tv_sec = now.tv_sec + (tmp / (1000 * 1000));        dst.tv_nsec = (tmp % (1000 * 1000)) * 1000;        pthread_mutex_lock(&event->mutex);        ret = pthread_cond_timedwait(&event->cond, &event->mutex, &dst);        pthread_mutex_unlock(&event->mutex);    }    event->flag = 0;    return ret;}